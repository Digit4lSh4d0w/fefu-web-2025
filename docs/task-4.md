# Задание №4

- Настроить встроенную систему аутентификации `Django`.
- Реализовать для пользователя возможности:
  - Регистрация.
  - Вход.
  - Выход.
- Настроить разграничение прав доступа.
- Реализовать персональные кабинеты пользователей.
- Обеспечить безопасность пользовательских данных.
- Интегрировать новую функциональность не нарушая существующую.

## Критерии оценивания

| №   | Задача                                   | Количество баллов | Выполнено ? |
| --- | ---------------------------------------- | ----------------- | ----------- |
| 1   | Рабочая система регистрации              | 5                 | ✅          |
| 2   | Реализован функционал выхода из аккаунта | 5                 | ✅          |
| 3   | Реализована модель пользователя          | 5                 | ✅          |
| 4   | Безопасность паролей                     | 5                 | ✅          |
| 5   | Разграничение прав доступа               | 5                 | ✅          |
| 6   | Личные кабинеты                          | 5                 | ✅          |
| 7   | Обновленная навигация                    | 5                 | ✅          |
| 8   | Обработка ошибок                         | 5                 | ✅          |

## Отчет

### Система регистрации

Система регистрации реализована почти полностью через стандартные компоненты `Django`, а именно
`UserCreationForm` из `django.contrib.auth.forms`.

Сама форма регистрации переписана для унификации - раньше было две, под каждую роль, теперь одна.

<details>
  <summary>Скриншоты</summary>
  <h4>Обновленная форма обратной связи</h4>
  <a href="../assets/task-4/updated-registration.webp">
    <img src="../assets/task-4/updated-registration.webp" width="600"/>
  </a>
</details>

### Профили

После регистрации пользователю становится доступен личный профиль. Для двух существующих ролей
он разный, а для всех остальных - стандартный.

Доступ в профиль проверяется с помощью `LoginRequiredMixin`:

```python
class ProfileView(LoginRequiredMixin, views.View):
    ...
```

Этот миксин не позволяет неавторизованным пользователям попадать на эту страницу. Важно, чтобы
этот миксин в цепочке наследования был первым.

Если попробовать зайти на страничку, защищенную от неавторизованного просмотра, то будет получен
редирект на страницу входа, а в параметре перенаправления будет путь первоначальной страницы.

Пример - если перейти на страницу подробностей о курсе, то сработает редирект на страницу входа,
а в параметре перенаправления будет значение: `/login/?next=/course/bubenchick-search/`.

<details>
  <summary>Скриншоты</summary>
  <h4>Профиль студента</h4>
  <a href="../assets/task-4/student-profile.webp">
    <img src="../assets/task-4/student-profile.webp" width="600"/>
  </a>
  <h4>Профиль преподавателя</h4>
  <a href="../assets/task-4/teacher-profile.webp">
    <img src="../assets/task-4/teacher-profile.webp" width="600"/>
  </a>
  <h4>Профиль администратора</h4>
  <a href="../assets/task-4/admin-profile.webp">
    <img src="../assets/task-4/admin-profile.webp" width="600"/>
  </a>
</details>

### Авторизация

Если данные, переданные при авторизации, верны, то пользователя сразу же перенаправляет на
страницу профиля. Если же данные были некорректными, то пользователю сообщается об ошибке.

<details>
  <summary>Скриншоты</summary>
  <h4>Авторизация с некорректными данными</h4>
  <a href="../assets/task-4/wrong-password.webp">
    <img src="../assets/task-4/wrong-password.webp" width="600"/>
  </a>
</details>

### Новые представления

Новое представление - смена пароля. Использует встроенное представление `PasswordChangeView`
с кастомным шаблоном для сохранения общего стиля.

<details>
  <summary>Скриншоты</summary>
  <h4>Смена пароля</h4>
  <a href="../assets/task-4/change-password.webp">
    <img src="../assets/task-4/change-password.webp" width="600"/>
  </a>
</details>

### Хэши паролей пользователей

```plaintext
┌────┬──────────────────────────────────────────────────────────────┬────────────────────────────┬──────────────┬──────────┬───────────┬─────────────────┬──────────┬───────────┬────────────────────────────┬────────────┐
│ id │                           password                           │         last_login         │ is_superuser │ username │ last_name │      email      │ is_staff │ is_active │        date_joined         │ first_name │
├────┼──────────────────────────────────────────────────────────────┼────────────────────────────┼──────────────┼──────────┼───────────┼─────────────────┼──────────┼───────────┼────────────────────────────┼────────────┤
│ 1  │ argon2$argon2id$v=19$m=102400,t=2,p=8$M3JNUW5BNjJNaGh4dTUzTm │ 2025-11-26 20:29:03.986480 │ 1            │ admin    │           │ admin@localhost │ 1        │ 1         │ 2025-11-19 14:09:52.726860 │            │
│    │ F2MHdWNg$kKXVKW09Yz4yq+czcVer4mIk1+rGeCkhvIW/GSzy2Vo         │                            │              │          │           │                 │          │           │                            │            │
├────┼──────────────────────────────────────────────────────────────┼────────────────────────────┼──────────────┼──────────┼───────────┼─────────────────┼──────────┼───────────┼────────────────────────────┼────────────┤
│ 14 │ argon2$argon2id$v=19$m=102400,t=2,p=8$czJZVjRwUVNtTHc3RlIwME │ 2025-11-26 20:02:27.146445 │ 0            │ teacher  │ Сафаров   │ teacher@ya.ru   │ 0        │ 1         │ 2025-11-20 15:11:18.667660 │ Александр  │
│    │ c0NlR4RQ$e4saPggP9Ccjr+Y87+PCJmgz6dUt7ig1v2if8MuB2MQ         │                            │              │          │           │                 │          │           │                            │            │
├────┼──────────────────────────────────────────────────────────────┼────────────────────────────┼──────────────┼──────────┼───────────┼─────────────────┼──────────┼───────────┼────────────────────────────┼────────────┤
│ 15 │ argon2$argon2id$v=19$m=102400,t=2,p=8$cVp3REhlNWVMa3Q5ZDlMT0 │ 2025-11-26 20:26:57.228208 │ 0            │ ivan     │ Редров    │ ivan@ya.ru      │ 0        │ 1         │ 2025-11-25 18:52:09.976446 │ Иван       │
│    │ RPZVFVUQ$ZvwNY6gHdhZ7p+WfSZfDJuqDAF96cbnOc/rEMEp6Nm4         │                            │              │          │           │                 │          │           │                            │            │
└────┴──────────────────────────────────────────────────────────────┴────────────────────────────┴──────────────┴──────────┴───────────┴─────────────────┴──────────┴───────────┴────────────────────────────┴────────────┘
```

<details>
  <summary>Скриншоты</summary>
  <h4>Пароль пользователя</h4>
  <a href="../assets/task-4/user-password.webp">
    <img src="../assets/task-4/user-password.webp" width="600"/>
  </a>
</details>
