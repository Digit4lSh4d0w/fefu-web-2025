# Задание №4

- Настроить встроенную систему аутентификации `Django`.
- Реализовать для пользователя возможности:
  - Регистрация.
  - Вход.
  - Выход.
- Настроить разграничение прав доступа.
- Реализовать персональные кабинеты пользователей.
- Обеспечить безопасность пользовательских данных.
- Интегрировать новую функциональность не нарушая существующую.

## Критерии оценивания

| №   | Задача                                   | Количество баллов | Выполнено ? |
| --- | ---------------------------------------- | ----------------- | ----------- |
| 1   | Рабочая система регистрации              | 5                 | ✅          |
| 2   | Реализован функционал выхода из аккаунта | 5                 | ✅          |
| 3   | Реализована модель пользователя          | 5                 | ✅          |
| 4   | Безопасность паролей                     | 5                 | ✅          |
| 5   | Разграничение прав доступа               | 5                 | ✅          |
| 6   | Личные кабинеты                          | 5                 | ✅          |
| 7   | Обновленная навигация                    | 5                 | ✅          |
| 8   | Обработка ошибок                         | 5                 | ✅          |

## Отчет

### Система регистрации

Система регистрации реализована почти полностью через стандартные компоненты `Django`, а именно
`UserCreationForm` из `django.contrib.auth.forms`.

Сама форма регистрации переписана для унификации - раньше было две, под каждую роль, теперь одна.

<details>
  <summary>Скриншоты</summary>
  <h4>Обновленная форма обратной связи</h4>
  <a href="../assets/task-4/updated-registration.webp">
    <img src="../assets/task-4/updated-registration.webp" width="600"/>
  </a>
</details>

### Профили

После регистрации пользователю становится доступен личный профиль. Для двух существующих ролей
он разный, а для всех остальных - стандартный.

Доступ в профиль проверяется с помощью `LoginRequiredMixin`:

```python
class ProfileView(LoginRequiredMixin, views.View):
    ...
```

Этот миксин не позволяет неавторизованным пользователям попадать на эту страницу. Важно, чтобы
этот миксин в цепочке наследования был первым.

Если попробовать зайти на страничку, защищенную от неавторизованного просмотра, то будет получен
редирект на страницу входа, а в параметре перенаправления будет путь первоначальной страницы.

Пример - если перейти на страницу подробностей о курсе, то сработает редирект на страницу входа,
а в параметре перенаправления будет значение: `/login/?next=/course/bubenchick-search/`.

<details>
  <summary>Скриншоты</summary>
  <h4>Профиль студента</h4>
  <a href="../assets/task-4/student-profile.webp">
    <img src="../assets/task-4/student-profile.webp" width="600"/>
  </a>
  <h4>Профиль преподавателя</h4>
  <a href="../assets/task-4/teacher-profile.webp">
    <img src="../assets/task-4/teacher-profile.webp" width="600"/>
  </a>
  <h4>Профиль администратора</h4>
  <a href="../assets/task-4/admin-profile.webp">
    <img src="../assets/task-4/admin-profile.webp" width="600"/>
  </a>
</details>

### Авторизация

Если данные, переданные при авторизации, верны, то пользователя сразу же перенаправляет на
страницу профиля. Если же данные были некорректными, то пользователю сообщается об ошибке.

<details>
  <summary>Скриншоты</summary>
  <h4>Авторизация с некорректными данными</h4>
  <a href="../assets/task-4/wrong-password.webp">
    <img src="../assets/task-4/wrong-password.webp" width="600"/>
  </a>
</details>

### Новые представления

Новое представление - смена пароля. Использует встроенное представление `PasswordChangeView`
с кастомным шаблоном для сохранения общего стиля.

<details>
  <summary>Скриншоты</summary>
  <h4>Смена пароля</h4>
  <a href="../assets/task-4/change-password.webp">
    <img src="../assets/task-4/change-password.webp" width="600"/>
  </a>
</details>

### Хэши паролей пользователей

Запрос в базу данных:

```sql
select password, username, last_name, first_name from auth_user;
```

```plaintext
┌──────────────────────────────────────────────────────────────┬──────────┬───────────┬────────────┐
│                           password                           │ username │ last_name │ first_name │
├──────────────────────────────────────────────────────────────┼──────────┼───────────┼────────────┤
│ argon2$argon2id$v=19$m=102400,t=2,p=8$M3JNUW5BNjJNaGh4dTUzTm │ admin    │           │            │
│ F2MHdWNg$kKXVKW09Yz4yq+czcVer4mIk1+rGeCkhvIW/GSzy2Vo         │          │           │            │
├──────────────────────────────────────────────────────────────┼──────────┼───────────┼────────────┤
│ argon2$argon2id$v=19$m=102400,t=2,p=8$czJZVjRwUVNtTHc3RlIwME │ teacher  │ Сафаров   │ Александр  │
│ c0NlR4RQ$e4saPggP9Ccjr+Y87+PCJmgz6dUt7ig1v2if8MuB2MQ         │          │           │            │
├──────────────────────────────────────────────────────────────┼──────────┼───────────┼────────────┤
│ argon2$argon2id$v=19$m=102400,t=2,p=8$cVp3REhlNWVMa3Q5ZDlMT0 │ ivan     │ Редров    │ Иван       │
│ RPZVFVUQ$ZvwNY6gHdhZ7p+WfSZfDJuqDAF96cbnOc/rEMEp6Nm4         │          │           │            │
├──────────────────────────────────────────────────────────────┼──────────┼───────────┼────────────┤
│ argon2$argon2id$v=19$m=102400,t=2,p=8$eDVJR09jSkNLa1NrU01SST │ bebra    │ Бебрович  │ Бебра      │
│ VwaVNQcA$SU5s5Em48QqHWIDT/l9USN36ftbG/ar5aKlWStdslLY         │          │           │            │
└──────────────────────────────────────────────────────────────┴──────────┴───────────┴────────────┘
```

<details>
  <summary>Скриншоты</summary>
  <h4>Пароль пользователя</h4>
  <a href="../assets/task-4/user-password.webp">
    <img src="../assets/task-4/user-password.webp" width="600"/>
  </a>
</details>
